---
title: "Agrupamiento-Universidades"
author: "Brayan Ortiz, Juan Peña, Thalea Hesse, Juan Falcon, Daniel Espinal"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(magrittr)
library(convertr)
library(dplyr)
library(stringr)
library(factoextra)
# library(zoo)
```


# Lectura de datos

```{r}
datos <- read.csv("datos/CollegeScorecard.csv")
```

# Procesamiento de los datos

El conjunto de datos cuentas con 1725 características, sin embargo muchas de ellas no contienen información. Por esta razón se deciden eliminar las característica que tengan más del 20% en valores NaN. Por otra parte, el conjunto de datos contiene diferentes formas para representar los valores vacíos, por ejemplo cadenas de texto vacías o con espacios y, adicionalmente, hay registros con valores en *PrivacySuppressed*. Todos estos valores se recopilaron y se replazaron por el objeto NA de R.  

Existen variables (INSTNM, NPCURL, INSTURL) con todos los valores, pero no aportan información para el análisis. Estas columnas también fueron eliminadas del conjunto de datos.


```{r}
# Reemplazar algunos valores con NA
df <- replace(datos, datos=="PrivacySuppressed", NA)
df <- replace(df, df==" ", NA)
df <- replace(df, df=="", NA)

# Se borran columnas con valores nulos (>20%)
df <- df[,-which(colMeans(is.na(df)) >= 0.2)]

# Se borran filas con valores nulos
# delete.na <- function(df, n=0) {
#  df[rowSums(is.na(df)) <= n,]
# }
# df <- delete.na(df)

# Eliminar columnas manualmente
df <- subset(df, select = -c(INSTNM, NPCURL, INSTURL, UNITID, 
                             OPEID, opeid6))
```

## Convertir los tipos de datos

```{r}
columnas <- data.frame(colnames(df))

columnas_CIP <- columnas %>% 
  filter(str_detect(colnames.df., "^CIP"))

df <- df %>% 
  mutate_at(vars(main, region, CURROPER), list(as.factor)) %>% 
  mutate_at(vars(columnas_CIP$colnames.df.), list(as.factor))
```

```{r}
#Separar df por tipo de columna
# colSums(is.na(df)/7804)

#Convertir todos los chr a factor
df <- df %>% mutate(across(.cols=where(is.character), .fns=as.factor))
df_fact <- df[sapply(df, is.factor)]

df_num <- df[sapply(df, is.numeric)]

#TODO
# addNA para añadir NA como level del factor.
# df <- modify(df, addNA)
```

```{r}
# División de los datos numéricos y categóricos

df_nums <- df %>% 
    select_if(is.numeric)
```
 
## Interpolación de los datos faltantes

```{r}
df_nums <- as.data.frame(na.approx(df_nums, rule = 2))
```

# Componentes principales

```{r}

nums_cp <- prcomp(df_nums_est, scale = TRUE, center = TRUE)
fviz_eig(nums_cp, ncp = 50)
fviz_pca_ind(nums_cp,
             col.ind = "cos2", # Color by the quality of representation
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             repel = TRUE     # Avoid text overlapping
             )
summary(nums_cp)
```

# Modelo

```{r}

```

